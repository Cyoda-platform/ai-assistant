{
  "initial_state": "start",
  "states": {
    "start": {
      "transitions": {
        "notify_start": {
          "next": "feedback_question",
          "action": {
            "name": "process_event",
            "config": {
              "type": "notification",
              "notification": "Feedback process initiated. Thank you for participating!",
              "publish": true,
              "allow_anonymous_users": true
            }
          }
        }
      }
    },
    "feedback_question": {
      "transitions": {
        "collect_feedback": {
          "next": "feedback_received",
          "action": {
            "name": "process_event",
            "config": {
              "type": "question",
              "question": "Please share your feedback on our service:",
              "example_answers": [
                "I really appreciate the fast support, but the interface could be improved."
              ],
              "publish": true,
              "allow_anonymous_users": true
            }
          }
        }
      }
    },
    "feedback_received": {
      "transitions": {
        "discuss_feedback": {
          "next": "feedback_received",
          "manual": true,
          "action": {
            "name": "process_event",
            "config": {
              "type": "agent",
              "publish": true,
              "allow_anonymous_users": true,
              "model": {},
              "tools": [
                {
                  "type": "function",
                  "function": {
                    "name": "set_additional_question_flag",
                    "description": "Set true if the discussion with the user is not complete and the user has additional feedback details to provide. If set to false, proceed with processing.",
                    "strict": true,
                    "parameters": {
                      "type": "object",
                      "properties": {
                        "transition": {
                          "type": "string",
                          "enum": [
                            "discuss_feedback"
                          ]
                        },
                        "require_additional_question_flag": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "transition",
                        "require_additional_question_flag"
                      ],
                      "additionalProperties": false
                    }
                  }
                }
              ],
              "messages": [
                {
                  "role": "user",
                  "content": [
                    "Your feedback seems brief. Would you like to add more details or clarify any points?"
                  ]
                }
              ],
              "tool_choice": "auto",
              "max_iteration": 30,
              "approve": true
            }
          }
        },
        "transition_to_feedback_processing_success": {
          "next": "processed",
          "condition": {
            "config": {
              "type": "function",
              "function": {
                "name": "is_stage_completed",
                "description": "Checks if the feedback discussion stage is complete.",
                "params": {
                  "transition": "discuss_feedback"
                }
              }
            }
          },
          "action": {
            "name": "process_event",
            "config": {
              "type": "agent",
              "publish": true,
              "allow_anonymous_users": true,
              "model": {},
              "tools": [
                {
                  "type": "function",
                  "function": {
                    "name": "sentiment_analysis",
                    "description": "Analyzes the sentiment of the feedback.",
                    "strict": true,
                    "parameters": {
                      "type": "object",
                      "properties": {
                        "text": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "text"
                      ],
                      "additionalProperties": false
                    }
                  }
                },
                {
                  "type": "function",
                  "function": {
                    "name": "entity_extraction",
                    "description": "Extracts key entities from the feedback.",
                    "strict": true,
                    "parameters": {
                      "type": "object",
                      "properties": {
                        "text": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "text"
                      ],
                      "additionalProperties": false
                    }
                  }
                }
              ],
              "messages": [
                {
                  "role": "user",
                  "content": [
                    "Proceeding with analysis: extract sentiment and key entities from the provided feedback: {{feedback}}"
                  ]
                }
              ],
              "tool_choice": "auto",
              "max_iteration": 10,
              "approve": true
            }
          }
        }
      }
    },
    "processed": {
      "transitions": {
        "save_feedback": {
          "next": "workflow_completed",
          "action": {
            "name": "process_event",
            "config": {
              "type": "prompt",
              "messages": [
                {
                  "role": "user",
                  "content": [
                    "Please make a summary"
                  ]
                }
              ],
              "publish": true,
              "allow_anonymous_users": true
            }
          }
        }
      }
    },
    "workflow_completed": {
      "transitions": {
        "notify_completion": {
          "next": "end",
          "action": {
            "name": "process_event",
            "config": {
              "type": "notification",
              "notification": "Feedback has been processed successfully. Thank you!",
              "publish": true,
              "allow_anonymous_users": true
            }
          }
        }
      }
    }
  }
}